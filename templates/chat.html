<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Chef d'Orchestre IA – Projet en cours</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
</head>
<body>
<div class="container">
    <!-- Colonne gauche : logs / étapes -->
    <div class="panel-left">
        <h2>Étapes &amp; Logs Orchestrateur</h2>
        <div id="logs-output"></div>
        {% if show_analyse_btn %}
            <form id="analyse-form" action="/analyser" method="post">
                <button type="submit" style="background:#ffd600;color:#222;font-weight:bold;">Analyser le projet</button>
            </form>
        {% endif %}
    </div>

    <!-- Colonne droite : zone de code + chat -->
    <div class="panel-right">
        <h3>Zone de code</h3>
        <pre id="code-output">{% if code %}{{ code }}{% else %}# Code extrait du ZIP (simulé){% endif %}</pre>
        
        <form class="chat-form" id="mon-formulaire">
            <input type="text" id="input-message" placeholder="Décrivez ce que vous souhaitez faire…" autocomplete="off" />
            <button type="submit">Envoyer</button>
        </form>
    </div>
</div>

<script>
function afficherLog(data) {
    // data.answer (texte IA), data.logs, data.result...
    let out = "";
    if (data.answer) out = data.answer;
    else if (data.logs) out = data.logs;
    else out = JSON.stringify(data, null, 2);
    document.getElementById("logs-output").textContent = out;
}

// Pour le chat
document.getElementById("mon-formulaire").onsubmit = function(e) {
    e.preventDefault();
    fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        message: document.getElementById("input-message").value
      })
    })
    .then(r => r.json())
    .then(afficherLog)
    .catch(err => { document.getElementById("logs-output").textContent = "Erreur réseau : " + err; });
    document.getElementById("input-message").value = "";
};

// Pour le bouton "Analyser le projet" (soumission AJAX)
const analyseForm = document.getElementById("analyse-form");
if(analyseForm){
    analyseForm.onsubmit = function(e){
        e.preventDefault();
        fetch("/analyser", {method: "POST"})
        .then(r => r.json())
        .then(afficherLog)
        .catch(err => { document.getElementById("logs-output").textContent = "Erreur analyse : " + err; });
    }
}
</script>
</body>
</html>
