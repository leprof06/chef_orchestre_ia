<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chef d'Orchestre IA – Project</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
</head>
<body>
<div class="container">
    <!-- Left column: logs/steps -->
    <div class="panel-left">
        <h2>Steps & Logs</h2>
        <div id="logs-output"></div>
        {% if show_analyse_btn %}
            <form id="analyse-form" action="/analyser" method="post">
                <button type="submit" class="analyse-btn">Analyze project</button>
            </form>
        {% endif %}
    </div>
    <!-- Right column: code zone + chat -->
    <div class="panel-right">
        <h3>Code Area</h3>
        <textarea id="code-editor" spellcheck="false">{% if code %}{{ code }}{% else %}# Project code will appear here...{% endif %}</textarea>
        <form class="chat-form" id="chat-form">
            <input type="text" id="input-message" placeholder="Describe what you want to do…" autocomplete="off" />
            <button type="submit">Send</button>
        </form>
    </div>
</div>
<script>
function afficherLog(data) {
    let out = "";
    if (data.answer) out = data.answer;
    else if (data.logs) out = data.logs;
    else out = JSON.stringify(data, null, 2);
    document.getElementById("logs-output").textContent = out;
}

document.getElementById("chat-form").onsubmit = function(e) {
    e.preventDefault();
    fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        message: document.getElementById("input-message").value
      })
    })
    .then(r => r.json())
    .then(afficherLog)
    .catch(err => { document.getElementById("logs-output").textContent = "Network error: " + err; });
    document.getElementById("input-message").value = "";
};

const analyseForm = document.getElementById("analyse-form");
if(analyseForm){
    analyseForm.onsubmit = function(e){
        e.preventDefault();
        fetch("/analyser", {method: "POST"})
        .then(r => r.json())
        .then(afficherLog)
        .catch(err => { document.getElementById("logs-output").textContent = "Analyse error: " + err; });
    }
}
</script>
</body>
</html>
