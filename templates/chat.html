<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Chef d'Orchestre IA – Projet en cours</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #fafbff; margin: 0; }
        .container { display: flex; flex-direction: row; width: 100vw; height: 100vh; }
        .panel-left { flex: 1; padding: 30px; background: #f8fafc; }
        .panel-right { flex: 2; padding: 30px; background: #f3f4f7; }
        #logs-output { 
            background: #222; color: #fafafa; padding: 18px; 
            border-radius: 8px; margin-bottom: 24px; font-size: 1.02em; 
            white-space: pre-wrap; min-height: 180px; font-family: 'Fira Mono', monospace;
        }
        #code-output { 
            background: #191e2b; color: #ffe8a3; padding: 16px; 
            border-radius: 8px; min-height: 220px; font-family: 'Fira Mono', monospace; 
            font-size: 1.04em;
        }
        .chat-form { display: flex; gap: 12px; margin-top: 22px; }
        .chat-form input[type="text"] {
            flex: 1; padding: 10px 14px; border: 1px solid #e0e7ef; border-radius: 6px;
            font-size: 1em; background: #fff;
        }
        .chat-form button {
            padding: 10px 22px; background: #4f8cff; color: #fff;
            border: none; border-radius: 6px; font-size: 1em;
            cursor: pointer; transition: background 0.15s;
        }
        .chat-form button:hover { background: #2957c6; }
    </style>
</head>
<body>
<div class="container">
    <!-- Colonne gauche : logs / étapes -->
    <div class="panel-left">
        <h2>Étapes &amp; Logs Orchestrateur</h2>
        <div id="logs-output"></div>
        {% if show_analyse_btn %}
            <form id="analyse-form" action="/analyser" method="post">
                <button type="submit" style="background:#ffd600;color:#222;font-weight:bold;">Analyser le projet</button>
            </form>
        {% endif %}
    </div>

    <!-- Colonne droite : zone de code + chat -->
    <div class="panel-right">
        <h3>Zone de code</h3>
        <pre id="code-output">{% if code %}{{ code }}{% else %}# Code extrait du ZIP (simulé){% endif %}</pre>
        
        <form class="chat-form" id="mon-formulaire">
            <input type="text" id="input-message" placeholder="Décrivez ce que vous souhaitez faire…" autocomplete="off" />
            <button type="submit">Envoyer</button>
        </form>
    </div>
</div>

<script>
function afficherLog(data) {
    // data.answer (texte IA), data.logs, data.result...
    let out = "";
    if (data.answer) out = data.answer;
    else if (data.logs) out = data.logs;
    else out = JSON.stringify(data, null, 2);
    document.getElementById("logs-output").textContent = out;
}

// Pour le chat
document.getElementById("mon-formulaire").onsubmit = function(e) {
    e.preventDefault();
    fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        message: document.getElementById("input-message").value
      })
    })
    .then(r => r.json())
    .then(afficherLog)
    .catch(err => { document.getElementById("logs-output").textContent = "Erreur réseau : " + err; });
    document.getElementById("input-message").value = "";
};

// Pour le bouton "Analyser le projet" (soumission AJAX)
const analyseForm = document.getElementById("analyse-form");
if(analyseForm){
    analyseForm.onsubmit = function(e){
        e.preventDefault();
        fetch("/analyser", {method: "POST"})
        .then(r => r.json())
        .then(afficherLog)
        .catch(err => { document.getElementById("logs-output").textContent = "Erreur analyse : " + err; });
    }
}
</script>
</body>
</html>
