<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Scan approfondi</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; padding: 2em; }
    h1 { color: #222; }
    .file { background: #fff; padding: 1em; border: 1px solid #ccc; margin-bottom: 2em; border-left: 6px solid #007bff; }
    pre { background: #f0f0f0; padding: 1em; overflow-x: auto; white-space: pre-wrap; }
    .status { font-size: 0.9em; color: #666; margin-top: 0.5em; }
    .actions { margin-top: 2em; padding: 1em; background: #eef; border-left: 4px solid #007bff; }
    .actions form, .actions a { display: inline-block; margin-right: 1em; }
  </style>
</head>
<body>
  <h1>🔎 Résultat du scan approfondi</h1>

  {% if updates %}
    <h2>🔁 Fichiers mis à jour ou ajoutés :</h2>
    <ul>
      {% for path, message in updates %}
        <li><strong>{{ path }}</strong> — {{ message }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>✅ Aucun changement détecté depuis le dernier scan.</p>
  {% endif %}

  <div class="actions">
    <form method="post" action="{{ url_for('test_runner.generate_ai_report') }}">
      <button type="submit">🧠 Générer un rapport global intelligent</button>
    </form>
    <form method="get" action="{{ url_for('deep_scan.scan') }}">
      <button type="submit">🔍 Refaire une analyse technique approfondie</button>
    </form>
    <form method="post" action="{{ url_for('test_runner.run_test_routes') }}">
      <button type="submit">🧪 Lancer les tests API (test_routes.py)</button>
    </form>
    <form method="post" action="{{ url_for('deep_scan.purge_cache') }}">
      <button type="submit">🗑️ Supprimer le cache</button>
    </form>
    <a href="/static/rapport/rapport_global.json" target="_blank">
      <button type="button">📥 Voir le rapport global</button>
    </a>
  </div>

  <h2>📄 Contenu analysé :</h2>
  {% for path, content in files.items() %}
    <div class="file">
      <h3>{{ path }}</h3>
      <pre>{{ content }}</pre>
    </div>
  {% endfor %}

  <br>
  <a href="/">⬅️ Retour à l’accueil</a>
</body>
</html>
